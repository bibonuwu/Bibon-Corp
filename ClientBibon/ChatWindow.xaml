<Window x:Class="SharedChat.ChatWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        Title="Chat"
        Height="640" Width="460"
        WindowStartupLocation="CenterOwner"
        Background="#1E1E1F" Foreground="White">

    <Window.Resources>
        <!-- цвета под референс -->
        <SolidColorBrush x:Key="MineBrush"  Color="#3A3A3C"/>
        <!-- свои -->
        <SolidColorBrush x:Key="OtherBrush" Color="#3A3A3C"/>
        <!-- чужие -->
        <SolidColorBrush x:Key="TimeBrush"  Color="#B3FFFFFF"/>
        <SolidColorBrush x:Key="InputBg"    Color="#111112"/>
        <SolidColorBrush x:Key="SendBg"     Color="#2AABEE"/>

        <!-- айтемы списка: без выделения; выравнивание по IsMine -->
        <Style TargetType="ListBoxItem">
            <Setter Property="Padding" Value="0"/>
            <Setter Property="BorderThickness" Value="0"/>
            <Setter Property="Background" Value="Transparent"/>
            <Setter Property="Focusable" Value="False"/>
            <Setter Property="HorizontalContentAlignment" Value="Left"/>
            <Style.Triggers>
                <DataTrigger Binding="{Binding IsMine}" Value="True">
                    <Setter Property="HorizontalContentAlignment" Value="Right"/>
                </DataTrigger>
            </Style.Triggers>
        </Style>


    </Window.Resources>

    <Grid Margin="10">
        <Grid.RowDefinitions>
            <RowDefinition Height="*"/>
            <RowDefinition Height="Auto"/>
        </Grid.RowDefinitions>

        <!-- СООБЩЕНИЯ -->
        <ListBox x:Name="MsgList" Grid.Row="0" BorderThickness="0">
            <!-- ВАЖНО: только один Background -->
            <ListBox.Background>
                <ImageBrush ImageSource="/Resurse/chatbackground.jpg"
                           />
            </ListBox.Background>

            <ListBox.ItemsPanel>
                <ItemsPanelTemplate>
                    <StackPanel/>
                </ItemsPanelTemplate>
            </ListBox.ItemsPanel>

            <ListBox.ItemTemplate>
                <DataTemplate>
                    <Border Margin="6,6"
                MaxWidth="340"
                BorderThickness="0"
                CornerRadius="22">
                        <Border.Style>
                            <Style TargetType="Border">
                                <Setter Property="Background" Value="{StaticResource OtherBrush}"/>
                                <Setter Property="Padding" Value="14,10,14,8"/>
                                <Style.Triggers>
                                    <DataTrigger Binding="{Binding IsMine}" Value="True">
                                        <Setter Property="Background" Value="{StaticResource MineBrush}"/>
                                        <Setter Property="Padding" Value="14,10,18,8"/>
                                    </DataTrigger>
                                </Style.Triggers>
                            </Style>
                        </Border.Style>

                        <Grid>
                            <Grid.RowDefinitions>
                                <RowDefinition Height="Auto"/>
                                <RowDefinition Height="Auto"/>
                            </Grid.RowDefinitions>

                            <!-- ТОЛЬКО текст сообщения -->
                            <TextBlock Grid.Row="0"
                           Text="{Binding Body}"
                           TextWrapping="Wrap"
                           Foreground="White"/>

                            <!-- Низ: время + галочки (только у своих) -->
                            <StackPanel Grid.Row="1"
                            Orientation="Horizontal"
                            HorizontalAlignment="Right"
                            Margin="0,6,0,0">
                                <TextBlock Text="{Binding Time}"
                               Foreground="{StaticResource TimeBrush}"
                               FontSize="11"
                               Margin="0,0,4,0"/>

                            </StackPanel>
                        </Grid>
                    </Border>
                </DataTemplate>
            </ListBox.ItemTemplate>


        </ListBox>

        <!-- ВВОД -->
        <Grid Grid.Row="1" Margin="0,10,0,2">


            <!-- капсула -->
            <Border Background="{StaticResource InputBg}" CornerRadius="22"
                    BorderThickness="1" BorderBrush="#3A3A3C" Height="44" Cursor="">
                <Grid Cursor="">
                    <TextBox x:Name="Input"
         Background="Transparent" BorderThickness="0"
         Foreground="White" CaretBrush="White"
         Padding="16,10,16,10"
         TextWrapping="Wrap" AcceptsReturn="True" MaxLines="4"
         VerticalContentAlignment="Center"
         PreviewKeyDown="Input_PreviewKeyDown"/>


                    <!-- Плейсхолдер -->
                    <TextBlock Text="Message"
               Foreground="#66FFFFFF"
               Margin="16,0,0,0"
               VerticalAlignment="Center"
               IsHitTestVisible="False">
                        <TextBlock.Style>
                            <Style TargetType="TextBlock">
                                <Setter Property="Visibility" Value="Collapsed"/>
                                <Style.Triggers>
                                    <DataTrigger Binding="{Binding Text, ElementName=Input}" Value="">
                                        <Setter Property="Visibility" Value="Visible"/>
                                    </DataTrigger>
                                </Style.Triggers>
                            </Style>
                        </TextBlock.Style>
                    </TextBlock>
                    <Button Content="▶"
        Margin="8,0,5,0"
        Click="Send_Click"
        HorizontalAlignment="Right"
        Background="Transparent"
        BorderBrush="Transparent"
        Foreground="White"
        Width="42"
        FontSize="17"
        Cursor="Hand" Height="42">
                        <Button.Template>
                            <ControlTemplate TargetType="Button">
                                <ContentPresenter VerticalAlignment="Center" HorizontalAlignment="Center"/>
                            </ControlTemplate>
                        </Button.Template>
                    </Button>
                </Grid>

            </Border>


        </Grid>
    </Grid>
</Window>
